<!DOCTYPE html>
<html lang="en">
<head>
    <title>TODO-list</title>
    <!-- Required meta tags -->
    <meta charset="utf-8">
    <meta content="width=device-width, initial-scale=1, shrink-to-fit=no" name="viewport">
    <!-- Bootstrap CSS -->
    <link crossorigin="anonymous" href="https://maxcdn.bootstrapcdn.com/bootstrap/4.0.0/css/bootstrap.min.css"
          integrity="sha384-Gn5384xqQ1aoWXA+058RXPxPg6fy4IWvTNh0E263XmFcJlSAwiGgFAW/dAiS6JXm" rel="stylesheet">
    <!-- jQuery first, then Popper.js, then Bootstrap JS -->
    <script crossorigin="anonymous"
            integrity="sha256-FgpCb/KJQlLNfOu91ta32o/NMZxltwRo8QtmkMRdAu8="
            src="https://code.jquery.com/jquery-3.3.1.min.js"></script>
    <script crossorigin="anonymous" integrity="sha384-ApNbgh9B+Y1QKtv3Rn7W3mgPxhU9K/ScQsAP7hUibX39j7fakFPskvXusvfa0b4Q"
            src="https://cdnjs.cloudflare.com/ajax/libs/popper.js/1.12.9/umd/popper.min.js"></script>
    <script crossorigin="anonymous" integrity="sha384-JZR6Spejh4U02d8jOt6vLEHfe/JQGiRRSQQxSfFWpi1MquVdAyjUar5+76PVCmYl"
            src="https://maxcdn.bootstrapcdn.com/bootstrap/4.0.0/js/bootstrap.min.js"></script>

    <script>
        $(function () {
            const context = location.href;
            const servletGetItems = context + "/items";

            /* * * * * * * * * * *
             * WORKING WITH ITEMS
             * * * * * * * * * * */

            function getItems() {
                let result = '';
                $.ajax({
                    type: 'GET',
                    async: false,
                    datatype: "application/json",
                    url: servletGetItems,
                    success: function (response) {
                        let received = JSON.parse(response);
                        if (received.error != null) {
                            alert(response.error);
                        } else {
                            result = received;
                        }
                    }
                });
                return result;
            }

            function redrawTableItems(items, showAll) {
                $("#existing-items-table").html(
                    drawTableItems(items, showAll)
                );
            }

            /**
             * Function drawing table of existing items
             *
             * @param items Array of existing items to show in table.
             * @param showAll Flag. True means show items which are done,
             * False means not to show.
             */
            function drawTableItems(items, showAll) {
                let html = '';
                html += '<table id="existing-items-table" class="table table-bordered">';
                html += '<thead style="text-align:center;">';
                html += drawTableItemsHead();
                html += '</thead>';
                html += '<tbody style="text-align:center">';
                items.forEach(function (item) {
                    if (showAll || !(item.done)) {
                        html += drawTableItemsItemRow(item);
                    }
                });
                html += '</tbody>';
                html += "</table>";
                return html;
            }

            function drawTableItemsHead() {
                let html = '';
                html += '<tr>';
                html += '<th>ID</th>';
                html += '<th>Description</th>';
                html += '<th>Created</th>';
                html += '<th>Done</th>';
                html += '</tr>';
                return html;
            }

            function drawTableItemsItemRow(item) {
                let html = '';
                html += '<tr>';
                html += '<td>' + item.id + '</td>';
                html += '<td>' + item.description + '</td>';
                html += '<td>' + new Date(item.created).toLocaleString() + '</td>';
                let checkboxId = item.id + '-done-checkbox';
                html += '<td>'
                    + '<input id="' + checkboxId + '" '
                    + 'type="checkbox"'
                    + (item.done ? ' checked' : '')
                    + '>'
                    + '</td>';
                html += '</tr>';
                return html;
            }

            /* * * * * *
             * LISTENERS
             * * * * * */

            /**
             * Listener on button to create new task.
             */
            $("#add-task-submit").click(function () {
                alert($("#add-task-description").val())
            });

            $("#showAll-checkbox").change(function () {
                pageShowAllItems = this.checked;
                redrawTableItems(pageCurrentItems, pageShowAllItems)
            });


            /* * * * * * *
            PAGE VARIABLES
            * * * * * *  */

            let pageShowAllItems = false;
            let pageCurrentItems = getItems();

            /* * * * * * * * *
             * AFTER PAGE LOAD
             * * * * * * * * */

            redrawTableItems(pageCurrentItems, pageShowAllItems);

        });
    </script>


</head>
<body>

<!--
  -- Header
  -->
<div align="center" class="container">
    <h3>TODO-List</h3>
</div>

<!--
  -- Add new task
  -->
<div class="container" style="margin-top: 20px">
    <div class="input-group">
        <textarea class="form-control" id="add-task-description" placeholder="Enter task description"></textarea>
        <div class="input-group-prepend">
            <button class="btn btn-primary" id="add-task-submit" type="button">Add task</button>
        </div>
    </div>
</div>

<!--
  -- Show existing tasks
  -->
<div align="center" class="container" style="margin-top: 20px">
    <div class="row float-right">
        <div class="custom-control custom-checkbox">
            <input class="custom-control-input" id="showAll-checkbox" type="checkbox">
            <label class="custom-control-label" for="showAll-checkbox">Show all</label>
        </div>
    </div>


    <div id="existing-items-table"></div>
</div>

</body>
</html>